Version 4
SHEET 1 1696 1340
WIRE -288 -160 -416 -160
WIRE -48 -160 -96 -160
WIRE 0 -160 -48 -160
WIRE 112 -160 64 -160
WIRE 976 -160 800 -160
WIRE 1152 -160 976 -160
WIRE 1568 -160 1392 -160
WIRE 800 -96 800 -160
WIRE 976 -96 976 -160
WIRE 1152 -96 1152 -160
WIRE -288 -80 -288 -160
WIRE -96 -80 -96 -160
WIRE 1568 48 1440 48
WIRE -288 64 -288 0
WIRE -192 64 -288 64
WIRE -96 64 -96 0
WIRE -96 64 -192 64
WIRE 800 64 800 -16
WIRE 976 64 976 -32
WIRE 1152 64 1152 -16
WIRE 1152 64 976 64
WIRE 1392 64 1392 -160
WIRE 1392 64 1152 64
WIRE 1440 80 1440 48
WIRE 1392 96 1392 64
WIRE 1152 112 1152 64
WIRE -192 128 -192 64
WIRE 1392 144 1376 144
WIRE 1376 208 1376 144
WIRE 1440 208 1440 160
WIRE 1152 240 1152 192
WIRE 1152 336 1152 304
WIRE -336 384 -496 384
WIRE -176 384 -336 384
WIRE 48 384 -176 384
WIRE 208 384 48 384
WIRE 384 384 208 384
WIRE 496 384 448 384
WIRE 640 384 576 384
WIRE 736 384 640 384
WIRE 848 384 800 384
WIRE 976 384 912 384
WIRE 1088 384 976 384
WIRE 48 400 48 384
WIRE 208 400 208 384
WIRE -496 480 -496 384
WIRE -336 480 -336 384
WIRE 48 480 48 464
WIRE 208 480 208 464
WIRE 448 480 448 384
WIRE 640 480 640 384
WIRE 800 480 800 384
WIRE 976 480 976 384
WIRE -848 496 -1056 496
WIRE -752 496 -848 496
WIRE -544 496 -752 496
WIRE -176 496 -176 384
WIRE 384 496 384 384
WIRE 400 496 384 496
WIRE 736 496 736 384
WIRE 752 496 736 496
WIRE -1056 544 -1056 496
WIRE -640 544 -848 544
WIRE -544 544 -640 544
WIRE 400 544 384 544
WIRE 752 544 736 544
WIRE -752 576 -752 496
WIRE -640 576 -640 544
WIRE -496 608 -496 560
WIRE -336 608 -336 560
WIRE -176 608 -176 560
WIRE 48 608 48 560
WIRE 208 608 208 560
WIRE 384 608 384 544
WIRE 448 608 448 560
WIRE 640 608 640 544
WIRE 736 608 736 544
WIRE 800 608 800 560
WIRE 976 608 976 560
WIRE 1152 608 1152 432
WIRE -1056 688 -1056 624
WIRE -752 688 -752 656
WIRE -640 688 -640 656
WIRE -752 864 -912 864
WIRE -592 864 -752 864
WIRE -432 864 -592 864
WIRE -224 864 -432 864
WIRE -96 864 -160 864
WIRE 128 864 64 864
WIRE 560 864 400 864
WIRE 720 864 560 864
WIRE 880 864 720 864
WIRE 1088 864 880 864
WIRE 1216 864 1152 864
WIRE -592 880 -592 864
WIRE -432 880 -432 864
WIRE 720 880 720 864
WIRE 880 880 880 864
WIRE -912 960 -912 864
WIRE -752 960 -752 864
WIRE -592 960 -592 944
WIRE -432 960 -432 944
WIRE -160 960 -160 864
WIRE 64 960 64 864
WIRE 400 960 400 864
WIRE 560 960 560 864
WIRE 720 960 720 944
WIRE 880 960 880 944
WIRE 1152 960 1152 864
WIRE -960 976 -1040 976
WIRE -224 976 -224 864
WIRE -208 976 -224 976
WIRE 352 976 272 976
WIRE 1088 976 1088 864
WIRE 1104 976 1088 976
WIRE -960 1024 -1008 1024
WIRE -208 1024 -224 1024
WIRE 352 1024 304 1024
WIRE 1104 1024 1088 1024
WIRE -1008 1088 -1008 1024
WIRE -912 1088 -912 1040
WIRE -752 1088 -752 1040
WIRE -592 1088 -592 1040
WIRE -432 1088 -432 1040
WIRE -224 1088 -224 1024
WIRE -160 1088 -160 1040
WIRE 64 1088 64 1040
WIRE 304 1088 304 1024
WIRE 400 1088 400 1040
WIRE 560 1088 560 1040
WIRE 720 1088 720 1040
WIRE 880 1088 880 1040
WIRE 1088 1088 1088 1024
WIRE 1152 1088 1152 1040
FLAG -848 544 FB
IOPIN -848 544 In
FLAG -496 608 0
FLAG -336 608 0
FLAG 48 608 0
FLAG 208 608 0
FLAG 384 608 0
FLAG 448 608 0
FLAG -848 496 NINV
FLAG -176 608 0
FLAG 976 608 0
FLAG 1152 608 0
FLAG 800 64 0
FLAG 736 608 0
FLAG 800 608 0
FLAG 640 608 0
FLAG -752 688 0
FLAG -640 688 0
FLAG -1040 976 dx
FLAG -1008 1088 0
FLAG -912 1088 0
FLAG -752 1088 0
FLAG -592 1088 0
FLAG -432 1088 0
FLAG -224 1088 0
FLAG -160 1088 0
FLAG -96 864 D
IOPIN -96 864 Out
FLAG 272 976 d2x
FLAG 304 1088 0
FLAG 400 1088 0
FLAG 560 1088 0
FLAG 720 1088 0
FLAG 880 1088 0
FLAG 1088 1088 0
FLAG 1152 1088 0
FLAG 1216 864 D2
IOPIN 1216 864 Out
FLAG 64 1088 0
FLAG 128 864 d2x
FLAG -416 -160 A
IOPIN -416 -160 BiDir
FLAG 112 -160 C
IOPIN 112 -160 BiDir
FLAG -192 128 P
IOPIN -192 128 BiDir
FLAG -48 -160 cx
FLAG 1568 48 dx
FLAG 1440 208 0
FLAG 1376 208 0
FLAG 1568 -160 COMP
IOPIN 1568 -160 BiDir
FLAG -1056 688 0
SYMBOL g -496 464 R0
SYMATTR InstName G1
SYMATTR Value 100µ
SYMBOL res -352 464 R0
SYMATTR InstName R1
SYMATTR Value 100Meg
SYMBOL voltage 48 464 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value {lim}
SYMBOL e 448 464 R0
SYMATTR InstName E1
SYMATTR Value 1
SYMBOL diode 32 464 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Invisible 2
SYMATTR InstName D1
SYMATTR Value clamp
SYMBOL diode 192 400 R0
WINDOW 3 24 64 Invisible 2
SYMATTR Value clamp
SYMATTR InstName D2
SYMBOL cap -192 496 R0
SYMATTR InstName C1
SYMATTR Value 33p
SYMBOL voltage 208 464 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value {Vcc_comp}
SYMBOL diode 848 368 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 Invisible 2
SYMATTR InstName D3
SYMATTR Value clamp
SYMBOL current 976 480 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName I1
SYMATTR Value 150µ
SYMBOL pnp 1088 432 M180
SYMATTR InstName Q1
SYMBOL current 1152 -96 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName I2
SYMATTR Value 500µ
SYMBOL diode 960 -32 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMATTR Value clamp
SYMBOL voltage 800 -112 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value {Vcc_comp}
SYMBOL diode 1136 240 R0
WINDOW 3 24 64 Invisible 2
SYMATTR Value clamp
SYMATTR InstName D5
SYMBOL voltage 1152 208 R180
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 0.7
SYMBOL e 800 464 R0
SYMATTR InstName E2
SYMATTR Value 1
SYMBOL res 592 368 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1k
SYMBOL cap 624 480 R0
SYMATTR InstName C2
SYMATTR Value 100p
SYMBOL res -656 560 R0
SYMATTR InstName R3
SYMATTR Value 8Meg
SYMBOL res -768 560 R0
SYMATTR InstName R4
SYMATTR Value 8Meg
SYMBOL g -912 944 R0
SYMATTR InstName G2
SYMATTR Value 100µ
SYMBOL res -768 944 R0
SYMATTR InstName R5
SYMATTR Value 10k
SYMBOL voltage -592 944 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value {lim}
SYMBOL bv -432 944 R0
SYMATTR InstName B1
SYMATTR Value V={1-lim}
SYMBOL e -160 944 R0
SYMATTR InstName E3
SYMATTR Value 1
SYMBOL g 400 944 R0
SYMATTR InstName G3
SYMATTR Value 100µ
SYMBOL res 544 944 R0
SYMATTR InstName R6
SYMATTR Value 10k
SYMBOL voltage 720 944 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value {lim}
SYMBOL bv 880 944 R0
SYMATTR InstName B2
SYMATTR Value V={1-lim}-V(d)
SYMBOL e 1152 944 R0
SYMATTR InstName E4
SYMATTR Value 1
SYMBOL bv 64 944 R0
WINDOW 3 -1 219 Left 2
SYMATTR Value V=I(Vsense)*{2*L*Fsw}/(V(d)*V(a,c)+1m)-V(d)
SYMATTR InstName B3
SYMBOL diode 704 944 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Invisible 2
SYMATTR InstName D6
SYMATTR Value clamp
SYMBOL diode 864 880 R0
WINDOW 3 24 64 Invisible 2
SYMATTR Value clamp
SYMATTR InstName D7
SYMBOL diode -608 944 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Invisible 2
SYMATTR InstName D8
SYMATTR Value clamp
SYMBOL diode -448 880 R0
WINDOW 3 24 64 Invisible 2
SYMATTR Value clamp
SYMATTR InstName D9
SYMBOL bi -288 -80 M0
WINDOW 3 56 41 Left 2
SYMATTR Value I=I(Vsense)*V(d)/(V(d)+V(d2))
SYMATTR InstName B4
SYMBOL bv -96 -96 R0
WINDOW 3 54 57 Left 2
SYMATTR Value V=V(a,p)*V(d)/(V(d)+V(d2))
SYMATTR InstName B5
SYMBOL Misc\\cell 0 -160 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 4 32 Invisible 2
WINDOW 123 0 0 Left 0
SYMATTR InstName Vsense
SYMATTR Value 0
SYMATTR SpiceLine Rser=1u
SYMBOL e 1440 64 R0
SYMATTR InstName E5
SYMATTR Value {Kpwm}
SYMBOL voltage -1056 528 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value {REF}
TEXT -1024 296 Left 2 !.model clamp D Ron=1m
TEXT -1024 264 Left 2 !.param L=75u Fsw=100k Tsw=1/Fsw lim=10m Kpwm=0.5 Vcc_comp=1/Kpwm Ref=1.25
LINE Normal -208 16 -208 -112 1
LINE Normal -176 16 -176 -112 1
