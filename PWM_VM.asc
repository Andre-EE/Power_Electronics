Version 4
SHEET 1 880 680
WIRE -1776 -464 -2192 -464
WIRE -1488 -464 -1680 -464
WIRE -1776 -416 -1824 -416
WIRE -1648 -416 -1664 -416
WIRE -1904 -400 -1936 -400
WIRE -1904 -384 -1904 -400
WIRE -2048 -368 -2080 -368
WIRE -1936 -368 -2048 -368
WIRE -1824 -352 -1824 -416
WIRE -1824 -352 -1872 -352
WIRE -272 -352 -336 -352
WIRE -160 -352 -272 -352
WIRE 16 -352 -160 -352
WIRE 432 -352 256 -352
WIRE -1936 -336 -2080 -336
WIRE -1904 -304 -1904 -320
WIRE -2192 -288 -2192 -464
WIRE -2080 -288 -2080 -336
WIRE -336 -288 -336 -352
WIRE -160 -288 -160 -352
WIRE 16 -288 16 -352
WIRE -2192 -128 -2192 -208
WIRE -2080 -128 -2080 -208
WIRE -336 -128 -336 -208
WIRE -160 -128 -160 -224
WIRE 16 -128 16 -208
WIRE 16 -128 -160 -128
WIRE 256 -128 256 -352
WIRE 256 -128 16 -128
WIRE 16 -80 16 -128
WIRE 16 48 16 0
WIRE 16 144 16 112
WIRE -1472 192 -1632 192
WIRE -1312 192 -1472 192
WIRE -1088 192 -1312 192
WIRE -928 192 -1088 192
WIRE -752 192 -928 192
WIRE -640 192 -688 192
WIRE -496 192 -560 192
WIRE -400 192 -496 192
WIRE -288 192 -336 192
WIRE -160 192 -224 192
WIRE -48 192 -160 192
WIRE -1088 208 -1088 192
WIRE -928 208 -928 192
WIRE -1632 288 -1632 192
WIRE -1472 288 -1472 192
WIRE -1088 288 -1088 272
WIRE -928 288 -928 272
WIRE -688 288 -688 192
WIRE -496 288 -496 192
WIRE -336 288 -336 192
WIRE -160 288 -160 192
WIRE -1984 304 -2192 304
WIRE -1888 304 -1984 304
WIRE -1680 304 -1888 304
WIRE -1312 304 -1312 192
WIRE -752 304 -752 192
WIRE -736 304 -752 304
WIRE -400 304 -400 192
WIRE -384 304 -400 304
WIRE -2192 352 -2192 304
WIRE -1776 352 -1984 352
WIRE -1680 352 -1776 352
WIRE -736 352 -752 352
WIRE -384 352 -400 352
WIRE -1888 384 -1888 304
WIRE -1776 384 -1776 352
WIRE -1632 416 -1632 368
WIRE -1472 416 -1472 368
WIRE -1312 416 -1312 368
WIRE -1088 416 -1088 368
WIRE -928 416 -928 368
WIRE -752 416 -752 352
WIRE -688 416 -688 368
WIRE -496 416 -496 352
WIRE -400 416 -400 352
WIRE -336 416 -336 368
WIRE -160 416 -160 368
WIRE 16 416 16 240
WIRE -2192 496 -2192 432
WIRE -1888 496 -1888 464
WIRE -1776 496 -1776 464
FLAG -1984 352 FB
IOPIN -1984 352 In
FLAG -1632 416 0
FLAG -1472 416 0
FLAG -1088 416 0
FLAG -928 416 0
FLAG -752 416 0
FLAG -688 416 0
FLAG -1984 304 NINV
FLAG -1312 416 0
FLAG -160 416 0
FLAG 16 416 0
FLAG -336 -128 0
FLAG -400 416 0
FLAG -336 416 0
FLAG -496 416 0
FLAG -1888 496 0
FLAG -1776 496 0
FLAG 432 -352 COMP
IOPIN 432 -352 BiDir
FLAG -2192 496 0
FLAG -272 -352 Vcc_comp
FLAG -2192 -128 0
FLAG -2080 -128 0
FLAG -1904 -304 0
FLAG -2048 -368 COMP
FLAG -1904 -400 Vcc_comp
FLAG -1488 -464 D
IOPIN -1488 -464 Out
SYMBOL g -1632 272 R0
SYMATTR InstName G1
SYMATTR Value 100µ
SYMBOL res -1488 272 R0
SYMATTR InstName R1
SYMATTR Value 100Meg
SYMBOL voltage -1088 272 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value {lim}
SYMBOL e -688 272 R0
SYMATTR InstName E1
SYMATTR Value 1
SYMBOL diode -1104 272 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Invisible 2
SYMATTR InstName D1
SYMATTR Value clamp
SYMBOL diode -944 208 R0
WINDOW 3 24 64 Invisible 2
SYMATTR Value clamp
SYMATTR InstName D2
SYMBOL cap -1328 304 R0
SYMATTR InstName C1
SYMATTR Value 33p
SYMBOL voltage -928 272 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value {1/Kpwm}
SYMBOL diode -288 176 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 Invisible 2
SYMATTR InstName D3
SYMATTR Value clamp
SYMBOL current -160 288 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName I1
SYMATTR Value 150µ
SYMBOL pnp -48 240 M180
SYMATTR InstName Q1
SYMBOL current 16 -288 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName I2
SYMATTR Value 500µ
SYMBOL diode -176 -224 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Invisible 2
SYMATTR InstName D4
SYMATTR Value clamp
SYMBOL diode 0 48 R0
WINDOW 3 24 64 Invisible 2
SYMATTR Value clamp
SYMATTR InstName D5
SYMBOL voltage 16 16 R180
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 0.7
SYMBOL e -336 272 R0
SYMATTR InstName E2
SYMATTR Value 1
SYMBOL res -544 176 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1k
SYMBOL cap -512 288 R0
SYMATTR InstName C2
SYMATTR Value 100p
SYMBOL res -1792 368 R0
SYMATTR InstName R3
SYMATTR Value 8Meg
SYMBOL res -1904 368 R0
SYMATTR InstName R4
SYMATTR Value 8Meg
SYMBOL voltage -2192 336 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value {Ref}
SYMBOL voltage -336 -304 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value {Vcc_comp}
SYMBOL Digital\\srflop -1728 -512 R0
SYMATTR InstName A1
SYMATTR Value2 Vhigh={Vcc_comp} Vlow=0 Ref={0.5*Vcc_comp}
SYMATTR SpiceLine Trise=0.1p Tfall=0.1p
SYMBOL voltage -2192 -304 R0
WINDOW 3 -26 241 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 {Vcc_comp} 1u 1n 1n {0.5*Tsw} {Tsw})
SYMATTR InstName V7
SYMBOL voltage -2080 -304 R0
WINDOW 3 -137 276 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 {Vcc_comp} 1u {Tsw-2p} 1p 1p {Tsw})
SYMATTR InstName V8
SYMBOL UniversalOpAmp2 -1904 -352 R0
SYMATTR Value2 Avol=1000G GBW=1000G Slew=1000G
SYMATTR SpiceLine Ilimit=2500m Rail=0 Vos=0
SYMATTR InstName U1
TEXT -2216 80 Left 2 !.param Fsw=100k Tsw=1/Fsw lim=10m Kpwm=0.5 Vcc_comp=1/Kpwm Ref=1.25
TEXT -2216 48 Left 2 !.model clamp D Ron=1m
